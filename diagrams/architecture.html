<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>beyond-vector-search — architecture</title>
    <style>
      :root {
        --bg: #0b1020;
        --panel: #101a33;
        --stroke: rgba(255, 255, 255, 0.18);
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.70);
        --accent: #7aa2f7;
        --good: #9ece6a;
        --warn: #e0af68;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial,
          "Apple Color Emoji", "Segoe UI Emoji";
        background: radial-gradient(1200px 800px at 20% 10%, rgba(122, 162, 247, 0.18), transparent 60%),
          radial-gradient(900px 600px at 80% 20%, rgba(158, 206, 106, 0.12), transparent 55%),
          var(--bg);
        color: var(--text);
      }
      .wrap {
        max-width: 1100px;
        margin: 0 auto;
        padding: 28px 18px 36px;
      }
      .header {
        display: flex;
        justify-content: space-between;
        gap: 14px;
        align-items: baseline;
        margin-bottom: 14px;
      }
      h1 {
        margin: 0;
        font-size: 18px;
        font-weight: 700;
        letter-spacing: 0.2px;
      }
      .sub {
        margin: 0;
        color: var(--muted);
        font-size: 13px;
        line-height: 1.4;
      }
      .card {
        background: linear-gradient(180deg, rgba(16, 26, 51, 0.82), rgba(16, 26, 51, 0.64));
        border: 1px solid var(--stroke);
        border-radius: 14px;
        padding: 14px;
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.35);
      }
      .grid {
        display: grid;
        grid-template-columns: 1.55fr 1fr;
        gap: 14px;
        margin-top: 14px;
      }
      .legend h2,
      .caption h2 {
        margin: 0 0 8px;
        font-size: 13px;
        letter-spacing: 0.2px;
        color: var(--muted);
        font-weight: 650;
      }
      .legend ul {
        margin: 0;
        padding-left: 18px;
        color: var(--muted);
        font-size: 13px;
        line-height: 1.55;
      }
      .pill {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 999px;
        border: 1px solid var(--stroke);
        background: rgba(122, 162, 247, 0.12);
        color: var(--text);
        font-size: 12px;
        white-space: nowrap;
      }
      .caption p {
        margin: 0 0 8px;
        color: var(--muted);
        font-size: 13px;
        line-height: 1.55;
      }
      .footer {
        margin-top: 12px;
        font-size: 12px;
        color: var(--muted);
      }
      code {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New",
          monospace;
        font-size: 0.95em;
        color: rgba(255, 255, 255, 0.88);
      }
      a {
        color: var(--accent);
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
      @media (max-width: 920px) {
        .grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="header">
        <div>
          <h1>Beyond Vector Search — Adaptive Retrieval Router (reference architecture)</h1>
          <p class="sub">
            Single-file HTML diagram (no external assets). Built for Medium/LinkedIn embedding and GitHub Pages.
          </p>
        </div>
        <div class="pill">diagrams/architecture.html</div>
      </div>

      <div class="card">
        <svg viewBox="0 0 1040 520" width="100%" height="auto" role="img" aria-label="Adaptive retrieval router architecture diagram">
          <defs>
            <linearGradient id="boxFill" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0%" stop-color="rgba(255,255,255,0.08)"></stop>
              <stop offset="100%" stop-color="rgba(255,255,255,0.04)"></stop>
            </linearGradient>
            <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
              <feDropShadow dx="0" dy="10" stdDeviation="12" flood-color="rgba(0,0,0,0.45)" />
            </filter>
            <marker id="arrow" viewBox="0 0 10 10" refX="9.5" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
              <path d="M 0 0 L 10 5 L 0 10 z" fill="rgba(255,255,255,0.65)"></path>
            </marker>
            <style>
              .box { fill: url(#boxFill); stroke: rgba(255,255,255,0.22); stroke-width: 1.2; rx: 14; filter: url(#shadow); }
              .box2 { fill: rgba(122,162,247,0.10); stroke: rgba(122,162,247,0.55); stroke-width: 1.3; rx: 14; filter: url(#shadow); }
              .box3 { fill: rgba(158,206,106,0.10); stroke: rgba(158,206,106,0.55); stroke-width: 1.3; rx: 14; filter: url(#shadow); }
              .label { fill: rgba(255,255,255,0.92); font: 650 14px ui-sans-serif, system-ui; }
              .small { fill: rgba(255,255,255,0.70); font: 12px ui-sans-serif, system-ui; }
              .arrow { stroke: rgba(255,255,255,0.60); stroke-width: 2.2; fill: none; marker-end: url(#arrow); }
              .arrow2 { stroke: rgba(122,162,247,0.80); stroke-width: 2.2; fill: none; marker-end: url(#arrow); }
              .arrow3 { stroke: rgba(158,206,106,0.80); stroke-width: 2.2; fill: none; marker-end: url(#arrow); }
              .dashed { stroke-dasharray: 7 7; }
              .cap { fill: rgba(255,255,255,0.62); font: 11px ui-sans-serif, system-ui; }
            </style>
          </defs>

          <!-- Main flow boxes -->
          <rect class="box" x="40" y="52" width="170" height="70" />
          <text class="label" x="60" y="82">User Query</text>
          <text class="small" x="60" y="104">Natural language / IDs</text>

          <rect class="box2" x="260" y="42" width="200" height="90" />
          <text class="label" x="280" y="74">Router</text>
          <text class="small" x="280" y="96">features + learned bias</text>
          <text class="small" x="280" y="116">selects strategy per query</text>

          <rect class="box" x="520" y="18" width="220" height="90" />
          <text class="label" x="540" y="50">Vector Retriever</text>
          <text class="small" x="540" y="72">char n-gram TF‑IDF</text>
          <text class="small" x="540" y="92">fuzzy similarity</text>

          <rect class="box" x="520" y="134" width="220" height="90" />
          <text class="label" x="540" y="166">Keyword Retriever</text>
          <text class="small" x="540" y="188">BM25-like scoring</text>
          <text class="small" x="540" y="208">exact match bias</text>

          <rect class="box3" x="790" y="62" width="210" height="80" />
          <text class="label" x="810" y="92">Context Builder</text>
          <text class="small" x="810" y="114">top‑k passages</text>

          <rect class="box3" x="790" y="170" width="210" height="80" />
          <text class="label" x="810" y="200">Answer Generator</text>
          <text class="small" x="810" y="222">template-based</text>

          <!-- Eval / feedback loop -->
          <rect class="box" x="520" y="300" width="220" height="85" />
          <text class="label" x="540" y="332">Evaluator</text>
          <text class="small" x="540" y="354">hit@k + exact match</text>
          <text class="small" x="540" y="374">(toy proxy)</text>

          <rect class="box" x="260" y="300" width="200" height="85" />
          <text class="label" x="280" y="332">Feedback Store</text>
          <text class="small" x="280" y="354">router weights</text>
          <text class="small" x="280" y="374">(+ eval history)</text>

          <rect class="box" x="790" y="300" width="210" height="85" />
          <text class="label" x="810" y="332">Logging / Telemetry</text>
          <text class="small" x="810" y="354">SQLite: query,</text>
          <text class="small" x="810" y="374">strategy, score</text>

          <!-- Arrows: online path -->
          <path class="arrow" d="M 210 87 L 260 87" />
          <text class="cap" x="220" y="74">request</text>

          <path class="arrow2" d="M 460 70 L 520 60" />
          <text class="cap" x="468" y="54">route (vector)</text>
          <path class="arrow2 dashed" d="M 460 104 L 520 170" />
          <text class="cap" x="468" y="136">route (keyword)</text>

          <path class="arrow" d="M 740 72 L 790 102" />
          <path class="arrow" d="M 740 180 L 790 202" />

          <path class="arrow3" d="M 895 142 L 895 170" />
          <text class="cap" x="905" y="162">context → answer</text>

          <!-- Arrow: logging -->
          <path class="arrow" d="M 895 250 L 895 300" />
          <text class="cap" x="905" y="286">log run</text>

          <!-- Evaluation loop -->
          <path class="arrow" d="M 895 250 C 895 270 740 270 630 300" />
          <text class="cap" x="760" y="274">evaluate (offline)</text>

          <path class="arrow3" d="M 630 385 L 360 385" />
          <text class="cap" x="470" y="402">write feedback</text>

          <path class="arrow3" d="M 360 300 C 360 250 360 180 360 132" />
          <text class="cap" x="372" y="210">update policy</text>

          <!-- Feedback -> Router -->
          <path class="arrow3 dashed" d="M 360 132 C 360 120 360 110 360 100" />

          <!-- Notes -->
          <text class="small" x="40" y="500">Key idea: routing is a decision problem; evaluation feeds back into routing weights over time.</text>
        </svg>
      </div>

      <div class="grid">
        <div class="card legend">
          <h2>Legend</h2>
          <ul>
            <li><span class="pill">Online path</span>: query → router → one retriever → context → answer</li>
            <li><span class="pill" style="background: rgba(158,206,106,0.12)">Feedback loop</span>: evaluator updates router policy via feedback store</li>
            <li><span class="pill" style="background: rgba(122,162,247,0.12)">Routing</span>: uses features (IDs/OOV/rarity) + learned bias</li>
            <li><strong>Telemetry</strong>: every run logs to SQLite for analysis and debugging</li>
          </ul>
        </div>

        <div class="card caption">
          <h2>Captions (Medium-friendly)</h2>
          <p>
            <strong>Router</strong> is where “learned retrieval” lives: it chooses which retriever should run for
            a given query, then uses evaluation feedback to adjust that choice over time.
          </p>
          <p>
            <strong>Vector vs keyword</strong> are intentionally different: char n-gram similarity is fuzzy; BM25-like
            scoring is exact-match biased.
          </p>
          <p class="footer">
            Tip: open this file locally, or publish it via GitHub Pages and link it from your blog/README.
          </p>
        </div>
      </div>
    </div>
  </body>
</html>



